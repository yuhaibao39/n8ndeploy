<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>访客管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">
</head>
<body>
    <div id="app" class="container mt-4">
        <!-- 导航栏 -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light mb-4">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">访客管理系统</a>
                <div class="collapse navbar-collapse">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#" @click="currentView='appointment'">预约管理</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" @click="currentView='checkin'">访客登记</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" @click="currentView='checkout'">访客离场</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- 预约表单 -->
        <div v-if="currentView === 'appointment'" class="card">
            <div class="card-header">
                <h5>访客预约</h5>
            </div>
            <div class="card-body">
                <form @submit.prevent="submitAppointment">
                    <div class="mb-3">
                        <label class="form-label">访客姓名</label>
                        <input type="text" class="form-control" v-model="appointment.visitorName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">手机号码</label>
                        <input type="tel" class="form-control" v-model="appointment.visitorPhone" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">身份证号</label>
                        <input type="text" class="form-control" v-model="appointment.visitorIdCard" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">被访人ID</label>
                        <input type="number" class="form-control" v-model="appointment.employeeId" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">来访目的</label>
                        <textarea class="form-control" v-model="appointment.visitPurpose" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">预约时间</label>
                        <input type="datetime-local" class="form-control" v-model="appointment.visitTime" required>
                    </div>
                    <button type="submit" class="btn btn-primary">提交预约</button>
                </form>
            </div>
        </div>

        <!-- 访客登记 -->
        <div v-if="currentView === 'checkin'" class="card">
            <div class="card-header">
                <h5>访客登记</h5>
            </div>
            <div class="card-body">
                <form @submit.prevent="submitCheckin">
                    <div class="mb-3">
                        <label class="form-label">预约ID</label>
                        <input type="number" class="form-control" v-model="checkin.appointmentId" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">人脸照片</label>
                        <input type="file" class="form-control" @change="handleFaceUpload" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-primary">登记入场</button>
                </form>
            </div>
        </div>

        <!-- 访客离场 -->
        <div v-if="currentView === 'checkout'" class="card">
            <div class="card-header">
                <h5>访客离场</h5>
            </div>
            <div class="card-body">
                <form @submit.prevent="submitCheckout">
                    <div class="mb-3">
                        <label class="form-label">访问记录ID</label>
                        <input type="number" class="form-control" v-model="checkout.visitId" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">访客证号</label>
                        <input type="text" class="form-control" v-model="checkout.cardNo" required>
                    </div>
                    <button type="submit" class="btn btn-primary">登记离场</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.31"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const app = Vue.createApp({
            data() {
                return {
                    currentView: 'appointment',
                    appointment: {
                        visitorName: '',
                        visitorPhone: '',
                        visitorIdCard: '',
                        employeeId: '',
                        visitPurpose: '',
                        visitTime: ''
                    },
                    checkin: {
                        appointmentId: '',
                        faceImage: ''
                    },
                    checkout: {
                        visitId: '',
                        cardNo: ''
                    }
                }
            },
            methods: {
                async submitAppointment() {
                    try {
                        const response = await axios.post('/api/v1/appointments', this.appointment);
                        alert('预约成功！预约ID：' + response.data.data.appointmentId);
                        this.resetForm('appointment');
                    } catch (error) {
                        alert('预约失败：' + error.message);
                    }
                },
                async submitCheckin() {
                    try {
                        const response = await axios.post('/api/v1/visits/check-in', this.checkin);
                        alert('登记成功！访客证号：' + response.data.data.cardNo);
                        this.resetForm('checkin');
                    } catch (error) {
                        alert('登记失败：' + error.message);
                    }
                },
                async submitCheckout() {
                    try {
                        const response = await axios.post('/api/v1/visits/check-out', this.checkout);
                        alert('离场登记成功！离场时间：' + response.data.data.checkOutTime);
                        this.resetForm('checkout');
                    } catch (error) {
                        alert('离场登记失败：' + error.message);
                    }
                },
                handleFaceUpload(event) {
                    const file = event.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.checkin.faceImage = e.target.result.split(',')[1];
                    };
                    reader.readAsDataURL(file);
                },
                resetForm(formType) {
                    if (formType === 'appointment') {
                        this.appointment = {
                            visitorName: '',
                            visitorPhone: '',
                            visitorIdCard: '',
                            employeeId: '',
                            visitPurpose: '',
                            visitTime: ''
                        };
                    } else if (formType === 'checkin') {
                        this.checkin = {
                            appointmentId: '',
                            faceImage: ''
                        };
                    } else if (formType === 'checkout') {
                        this.checkout = {
                            visitId: '',
                            cardNo: ''
                        };
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>